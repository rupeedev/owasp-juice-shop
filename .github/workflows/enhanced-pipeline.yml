name: Enhanced Pipeline with Security Scanning

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  # Stage 1: Lint (existing)
  lint:
    name: Lint Code
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'

      - name: Install dependencies
        run: npm install --prefer-offline --no-audit

      - name: Run linter
        run: npm run lint
        continue-on-error: true

  # Stage 2a: SAST (Parallel)
  sast:
    name: SAST - Static Analysis
    runs-on: ubuntu-latest
    needs: lint
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'

      - name: Install dependencies
        run: npm install --prefer-offline --no-audit

      - name: Run SAST (npm audit)
        run: |
          echo "üîç Running SAST scan..."
          # TODO: Implement CodeQL or Semgrep
          # For now, use npm audit as basic SAST
          npm audit --audit-level=high > npm-audit-sast.txt 2>&1 || echo "‚ö†Ô∏è  Vulnerabilities found (warning mode)"
          cat npm-audit-sast.txt
        continue-on-error: true  # Warning mode for training

      - name: Upload SAST Report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: sast-report
          path: npm-audit-sast.txt
          retention-days: 30

  # Stage 2b: Secret Detection (Parallel)
  secret-detection:
    name: Secret Detection
    runs-on: ubuntu-latest
    needs: lint
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Full history for secret scanning

      - name: Run Secret Detection
        run: |
          echo "üîê Scanning for secrets in git history..."
          # TODO: Implement TruffleHog or detect-secrets
          # For now, use basic git secrets check
          git log --all --pretty=format: --name-only | sort -u | xargs grep -i "password\|secret\|key" > secret-detection.txt 2>&1 || echo "‚úÖ No obvious secrets found"
          cat secret-detection.txt || echo "No secrets file generated"
        continue-on-error: true  # Warning mode for training

      - name: Upload Secret Detection Report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: secret-detection-report
          path: secret-detection.txt
          retention-days: 30

  # Stage 2c: Unit Tests (Parallel)
  test:
    name: Unit Tests
    runs-on: ubuntu-latest
    needs: lint
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'

      - name: Install dependencies
        run: npm install --prefer-offline --no-audit

      - name: Run unit tests
        run: npm test
        continue-on-error: true  # Warning mode for training

  # Stage 3: Security Scan (Advanced - runs after all Stage 2 jobs)
  security-scan:
    name: ${{ matrix.scan.display }}
    runs-on: ubuntu-latest
    needs: [sast, secret-detection, test]
    strategy:
      fail-fast: false  # Run all scans even if one fails
      matrix:
        scan:
          - name: npm-audit
            display: "npm Audit"
            tool: npm
          - name: trivy
            display: "Trivy Container Scan"
            tool: trivy
          - name: gitleaks
            display: "Gitleaks Secrets"
            tool: gitleaks
          - name: retirejs
            display: "RetireJS"
            tool: retire
          - name: dockerfile-policy
            display: "Dockerfile Policy (OPA)"
            tool: conftest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'
        if: matrix.scan.name == 'npm-audit' || matrix.scan.name == 'retirejs'

      # npm audit
      - name: Run npm audit
        if: matrix.scan.name == 'npm-audit'
        run: |
          echo "üì¶ Running npm audit..."
          npm audit --audit-level=moderate > npm-audit.txt 2>&1 || echo "‚ö†Ô∏è  Vulnerabilities found (warning mode)"
          cat npm-audit.txt
        continue-on-error: true

      # Trivy container scan (Using docker-based approach)
      - name: Run Trivy scan
        if: matrix.scan.name == 'trivy'
        run: |
          echo "üê≥ Running Trivy container scan..."
          echo "Building image for scanning..."
          docker build -t juice-shop:scan .

          echo ""
          echo "=== Trivy Scan - HIGH Severity (Warning) ===" | tee trivy-scan.txt
          docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
            -v $HOME/.cache:/root/.cache/ \
            aquasec/trivy:latest image --exit-code 0 --severity HIGH --light juice-shop:scan \
            2>&1 | tee -a trivy-scan.txt \
            || echo "‚ö†Ô∏è  HIGH severity vulnerabilities found"

          echo "" | tee -a trivy-scan.txt
          echo "=== Trivy Scan - CRITICAL Severity ===" | tee -a trivy-scan.txt
          docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
            -v $HOME/.cache:/root/.cache/ \
            aquasec/trivy:latest image --exit-code 0 --severity CRITICAL --light juice-shop:scan \
            2>&1 | tee -a trivy-scan.txt \
            || echo "‚ö†Ô∏è  CRITICAL vulnerabilities found (warning mode for training)"

          echo "üìä Trivy scan completed" | tee -a trivy-scan.txt
        continue-on-error: true

      # Gitleaks secret scanning
      - name: Run Gitleaks
        if: matrix.scan.name == 'gitleaks'
        run: |
          echo "üîê Running Gitleaks secret scan..."
          docker run --rm -v $(pwd):/repo zricethezav/gitleaks:latest detect --source /repo --verbose > gitleaks-report.txt 2>&1 || echo "‚ö†Ô∏è  Secrets found (warning mode)"
          cat gitleaks-report.txt || echo "No secrets detected"
        continue-on-error: true

      # RetireJS
      - name: Run RetireJS
        if: matrix.scan.name == 'retirejs'
        run: |
          echo "üìö Running RetireJS scan..."
          npm install -g retire
          retire --path . > retirejs-scan.txt 2>&1 || echo "‚ö†Ô∏è  Vulnerable libraries found (warning mode)"
          cat retirejs-scan.txt
        continue-on-error: true

      # OPA/Conftest - Dockerfile policy check
      - name: Run Dockerfile Policy Scan
        if: matrix.scan.name == 'dockerfile-policy'
        run: |
          echo "üìã Running OPA/Conftest policy validation..."
          echo "Using comprehensive security policy from docs/docker/dockerfile-security.rego"
          echo "Using docker-based conftest (no binary installation needed)"
          echo ""

          echo "üîç Testing Dockerfile against comprehensive security policies..." | tee dockerfile-policy.txt
          echo "" | tee -a dockerfile-policy.txt
          echo "Security checks include:" | tee -a dockerfile-policy.txt
          echo "  ‚úì No secrets in ENV variables" | tee -a dockerfile-policy.txt
          echo "  ‚úì Use trusted base images only" | tee -a dockerfile-policy.txt
          echo "  ‚úì No 'latest' tag for base images" | tee -a dockerfile-policy.txt
          echo "  ‚úì Avoid curl bashing" | tee -a dockerfile-policy.txt
          echo "  ‚úì No system package upgrades in Dockerfile" | tee -a dockerfile-policy.txt
          echo "  ‚úì Use COPY instead of ADD" | tee -a dockerfile-policy.txt
          echo "  ‚úì Don't run as root user" | tee -a dockerfile-policy.txt
          echo "  ‚úì Don't use sudo command" | tee -a dockerfile-policy.txt
          echo "  ‚úì Use multi-stage builds" | tee -a dockerfile-policy.txt
          echo "" | tee -a dockerfile-policy.txt

          # Use docker-based conftest with comprehensive policy
          set +e  # Disable exit on error for proper handling
          docker run --rm -v $(pwd):/project \
            openpolicyagent/conftest:latest \
            test --policy ./docs/docker/dockerfile-security.rego Dockerfile 2>&1 | tee -a dockerfile-policy.txt
          CONFTEST_EXIT_CODE=$?
          set -e  # Re-enable exit on error

          echo "" | tee -a dockerfile-policy.txt
          if [ $CONFTEST_EXIT_CODE -ne 0 ]; then
            echo "‚ö†Ô∏è  Policy violations found (exit code: $CONFTEST_EXIT_CODE)" | tee -a dockerfile-policy.txt
            echo "üìù This is expected for training - Juice Shop is intentionally vulnerable" | tee -a dockerfile-policy.txt
            echo "üìö Reference: https://cloudberry.engineering/article/dockerfile-security-best-practices/" | tee -a dockerfile-policy.txt
            echo "‚úÖ Pipeline continues in warning mode" | tee -a dockerfile-policy.txt
          else
            echo "‚úÖ All Dockerfile policies passed!" | tee -a dockerfile-policy.txt
          fi
        continue-on-error: true

      - name: Upload Security Scan Report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: security-scan-${{ matrix.scan.name }}
          path: |
            npm-audit.txt
            trivy-scan.txt
            gitleaks-report.txt
            retirejs-scan.txt
            dockerfile-policy.txt
          retention-days: 30

  # Stage 4: SonarQube (NEW - Manual gate)
  sonar:
    name: SonarQube Code Quality
    runs-on: ubuntu-latest
    needs: security-scan
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'

      - name: Install dependencies
        run: echo "Sonar stage - dependencies installed in sonar scanner"

      - name: SonarQube Scan (placeholder)
        run: |
          echo "üìä SonarQube analysis would run here"
          echo "‚ö†Ô∏è  Note: SonarQube requires server setup"
          echo "   For now, this is a placeholder for future integration"
          # TODO: Implement SonarCloud or self-hosted SonarQube
        continue-on-error: true

  # Stage 5: Build (existing)
  build:
    name: Build & Tag Docker Image
    runs-on: ubuntu-latest
    needs: sonar
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Build Docker image
        run: |
          docker build -t juice-shop:latest .
          echo "‚úÖ Docker image built successfully!"

      - name: Tag images
        run: |
          docker tag juice-shop:latest juice-shop:${{ github.sha }}
          docker tag juice-shop:latest juice-shop:enhanced
          echo "üè∑Ô∏è  Images tagged"

      - name: Save Docker image as artifact
        run: |
          docker save juice-shop:latest -o juice-shop-image.tar
          echo "üíæ Docker image saved"

      - name: Upload Docker image artifact
        uses: actions/upload-artifact@v4
        with:
          name: docker-image
          path: juice-shop-image.tar
          retention-days: 1

  # Stage 6: Push (existing)
  push-to-dockerhub:
    name: Push to Docker Hub
    runs-on: ubuntu-latest
    needs: build
    env:
      DOCKER_USERNAME: rupeedev
      DOCKER_REPO: owasp-juice-shop
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download Docker image artifact
        uses: actions/download-artifact@v4
        with:
          name: docker-image

      - name: Load Docker image
        run: docker load -i juice-shop-image.tar

      - name: Log in to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ env.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Tag and push images
        run: |
          docker tag juice-shop:latest ${{ env.DOCKER_USERNAME }}/${{ env.DOCKER_REPO }}:latest
          docker tag juice-shop:latest ${{ env.DOCKER_USERNAME }}/${{ env.DOCKER_REPO }}:${{ github.sha }}
          docker tag juice-shop:latest ${{ env.DOCKER_USERNAME }}/${{ env.DOCKER_REPO }}:enhanced

          docker push ${{ env.DOCKER_USERNAME }}/${{ env.DOCKER_REPO }}:latest
          docker push ${{ env.DOCKER_USERNAME }}/${{ env.DOCKER_REPO }}:${{ github.sha }}
          docker push ${{ env.DOCKER_USERNAME }}/${{ env.DOCKER_REPO }}:enhanced

  # Stage 7: Deploy (existing)
  deploy:
    name: Deploy to Kubernetes
    runs-on: self-hosted
    needs: push-to-dockerhub
    env:
      DOCKER_USERNAME: rupeedev
      DOCKER_REPO: owasp-juice-shop
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install kubectl
        run: |
          if ! command -v kubectl &> /dev/null; then
            curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
            chmod +x kubectl
            sudo mv kubectl /usr/local/bin/
          fi

      - name: Apply manifests
        run: |
          kubectl apply -f kind-k8s-cluster/juice-shop-deployment.yaml
          kubectl apply -f kind-k8s-cluster/juice-shop-service.yaml

      - name: Update deployment
        run: |
          kubectl set image deployment/juice-shop juice-shop=${{ env.DOCKER_USERNAME }}/${{ env.DOCKER_REPO }}:${{ github.sha }}

      - name: Wait for rollout
        run: |
          kubectl rollout status deployment/juice-shop --timeout=180s

      - name: Verify deployment
        run: |
          kubectl get pods -l app=juice-shop
          kubectl get svc juice-shop
          kubectl get deployment juice-shop

      - name: Get service endpoint
        run: |
          echo "üåê Application deployed at: http://localhost:30080"
        id: endpoint

  # Stage 8: K8s Security (NEW - DAST)
  k8s-security:
    name: K8s Security - DAST
    runs-on: self-hosted
    needs: deploy
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install kubectl (if not present)
        run: |
          if ! command -v kubectl &> /dev/null; then
            echo "üì• Installing kubectl..."
            curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
            chmod +x kubectl
            sudo mv kubectl /usr/local/bin/
            echo "‚úÖ kubectl installed"
          else
            echo "‚úÖ kubectl already installed"
          fi

      - name: Wait for application readiness
        run: |
          echo "‚è≥ Waiting for application to be ready..."
          sleep 30
          kubectl wait --for=condition=ready pod -l app=juice-shop --timeout=120s

      # Application Health Check
      - name: Application Health Check
        run: |
          echo "üè• Checking application health..."
          echo "Waiting for application to start responding..."

          MAX_RETRIES=10
          RETRY_COUNT=0
          SUCCESS=false

          while [ $RETRY_COUNT -lt $MAX_RETRIES ]; do
            echo "Attempt $((RETRY_COUNT + 1))/$MAX_RETRIES..."

            # Capture both HTTP code and curl exit code
            HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:30080 2>&1 || echo "000")

            if [ "$HTTP_CODE" = "200" ]; then
              echo "‚úÖ Application is responding (HTTP $HTTP_CODE)"
              SUCCESS=true
              break
            elif [ "$HTTP_CODE" = "000" ]; then
              echo "‚ö†Ô∏è  Connection failed - application not ready yet"
            else
              echo "‚ö†Ô∏è  Application returned HTTP $HTTP_CODE"
            fi

            RETRY_COUNT=$((RETRY_COUNT + 1))
            if [ $RETRY_COUNT -lt $MAX_RETRIES ]; then
              echo "Waiting 10 seconds before retry..."
              sleep 10
            fi
          done

          if [ "$SUCCESS" = false ]; then
            echo "‚ùå Application health check failed after $MAX_RETRIES attempts"
            echo "Checking pod status:"
            kubectl get pods -l app=juice-shop
            kubectl describe pod -l app=juice-shop | tail -50
            exit 1
          fi

      # K8s Manifest Security Scan
      - name: K8s Manifest Security Scan
        run: |
          echo "üîê Scanning Kubernetes manifests for security issues..." | tee k8s-manifest-scan.txt
          echo "" | tee -a k8s-manifest-scan.txt

          # Scan deployment and service manifests with OPA Conftest
          echo "=== Scanning K8s Deployment Manifest ===" | tee -a k8s-manifest-scan.txt
          docker run --rm -v $(pwd):/project \
            openpolicyagent/conftest:latest \
            test --policy ./policy kind-k8s-cluster/juice-shop-deployment.yaml \
            2>&1 | tee -a k8s-manifest-scan.txt \
            || echo "‚ö†Ô∏è  Policy violations in deployment manifest" | tee -a k8s-manifest-scan.txt

          echo "" | tee -a k8s-manifest-scan.txt
          echo "=== Scanning K8s Service Manifest ===" | tee -a k8s-manifest-scan.txt
          docker run --rm -v $(pwd):/project \
            openpolicyagent/conftest:latest \
            test --policy ./policy kind-k8s-cluster/juice-shop-service.yaml \
            2>&1 | tee -a k8s-manifest-scan.txt \
            || echo "‚ö†Ô∏è  Policy violations in service manifest" | tee -a k8s-manifest-scan.txt

          echo "" | tee -a k8s-manifest-scan.txt
          echo "üìù K8s manifest scan checks for:" | tee -a k8s-manifest-scan.txt
          echo "   - Containers running as non-root (runAsNonRoot)" | tee -a k8s-manifest-scan.txt
          echo "   - Security context settings" | tee -a k8s-manifest-scan.txt
          echo "   - Service type configurations" | tee -a k8s-manifest-scan.txt
          echo "   - Resource limits and requests" | tee -a k8s-manifest-scan.txt
          echo "üìö Reference: Best practices from DevSecOps patterns" | tee -a k8s-manifest-scan.txt
        continue-on-error: true

      # Security Headers Check
      - name: Security Headers Analysis
        run: |
          echo "üîí Analyzing HTTP security headers..."
          echo ""
          echo "=== Current Security Headers ==="
          curl -s -D - http://localhost:30080 -o /dev/null 2>&1 | grep -E "^X-|^Content-Security|^Strict-Transport" || true
          echo ""
          echo "=== Security Header Assessment ==="

          HEADERS=$(curl -s -D - http://localhost:30080 -o /dev/null 2>&1)

          # Check for present headers
          echo "$HEADERS" | grep -q "X-Content-Type-Options" && echo "‚úì X-Content-Type-Options: Present" || echo "‚úó X-Content-Type-Options: Missing"
          echo "$HEADERS" | grep -q "X-Frame-Options" && echo "‚úì X-Frame-Options: Present" || echo "‚úó X-Frame-Options: Missing"
          echo "$HEADERS" | grep -q "Content-Security-Policy" && echo "‚úì Content-Security-Policy: Present" || echo "‚úó Content-Security-Policy: Missing (expected)"
          echo "$HEADERS" | grep -q "Strict-Transport-Security" && echo "‚úì Strict-Transport-Security: Present" || echo "‚úó Strict-Transport-Security: Missing (expected)"
          echo "$HEADERS" | grep -q "X-XSS-Protection" && echo "‚úì X-XSS-Protection: Present" || echo "‚úó X-XSS-Protection: Missing (expected)"
          echo ""
          echo "‚ö†Ô∏è  Note: Juice Shop is intentionally vulnerable - missing headers are expected"
        continue-on-error: true

      # OWASP ZAP Baseline Scan (Optional - can be resource intensive)
      - name: OWASP ZAP Baseline Scan
        run: |
          echo "üîç Running OWASP ZAP baseline scan..."
          echo "Note: This may take 2-5 minutes..."

          # Use correct ZAP docker image: zaproxy/zap-stable
          timeout 300 docker run --rm --network host \
            zaproxy/zap-stable:latest \
            zap-baseline.py -t http://localhost:30080 -I -r zap-report.html \
            || echo "‚ö†Ô∏è  Security issues found or scan timed out (warning mode)"

          echo "üìä ZAP scan completed"
          echo "‚ö†Ô∏è  Findings are expected for intentionally vulnerable application"
        continue-on-error: true

      - name: Security scan complete
        run: |
          echo ""
          echo "‚úÖ K8s Security scans completed"
          echo "üìä Review DAST results for security findings"
          echo "‚ö†Ô∏è  Note: Juice Shop is intentionally vulnerable - findings are expected"
          echo ""

      - name: Upload K8s Security Reports
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: k8s-security-reports
          path: |
            k8s-manifest-scan.txt
            zap-report.html
          retention-days: 30

  # Stage 9: Security Report Consolidation
  consolidate-reports:
    name: Consolidate Security Reports
    runs-on: ubuntu-latest
    needs: k8s-security
    if: always()  # Run even if previous stages have failures
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Create reports directory
        run: mkdir -p security-reports

      - name: Download SAST Report
        uses: actions/download-artifact@v4
        continue-on-error: true
        with:
          name: sast-report
          path: security-reports/

      - name: Download Secret Detection Report
        uses: actions/download-artifact@v4
        continue-on-error: true
        with:
          name: secret-detection-report
          path: security-reports/

      - name: Download Security Scan Reports
        uses: actions/download-artifact@v4
        continue-on-error: true
        with:
          pattern: security-scan-*
          path: security-reports/
          merge-multiple: true

      - name: Download K8s Security Reports
        uses: actions/download-artifact@v4
        continue-on-error: true
        with:
          name: k8s-security-reports
          path: security-reports/

      - name: List downloaded reports
        run: |
          echo "üìã Downloaded security reports:"
          ls -lah security-reports/
          echo ""
          echo "Report files:"
          find security-reports/ -type f

      - name: Run consolidation script
        run: |
          chmod +x .github/scripts/consolidate-security-reports.sh
          .github/scripts/consolidate-security-reports.sh security-reports consolidated-reports

      - name: Display consolidation summary
        run: |
          echo ""
          echo "================================================================"
          echo "üìä Security Report Consolidation Summary"
          echo "================================================================"
          echo ""
          if [ -f "consolidated-reports/summary.txt" ]; then
            echo "Tool Summary:"
            cat consolidated-reports/summary.txt
          fi
          echo ""
          echo "Generated Reports:"
          ls -lh consolidated-reports/
          echo ""

      - name: Upload Consolidated Reports
        uses: actions/upload-artifact@v4
        with:
          name: consolidated-security-reports
          path: |
            consolidated-reports/security-dashboard.html
            consolidated-reports/security-report.md
            consolidated-reports/summary.txt
          retention-days: 90  # Keep consolidated reports longer

  # Final success message
  pipeline-complete:
    name: Pipeline Complete
    runs-on: ubuntu-latest
    needs: consolidate-reports
    steps:
      - name: Success message
        run: |
          echo "üéâ Enhanced Pipeline completed successfully!"
          echo ""
          echo "‚úÖ Pipeline Stages (Parallel Execution Optimized):"
          echo "   Stage 1: Lint ‚úì"
          echo "   Stage 2: SAST + Secret Detection + Unit Tests (parallel) ‚úì"
          echo "   Stage 3: Security Scan (Trivy, Gitleaks, RetireJS - parallel) ‚úì"
          echo "           + Dockerfile Policy Validation ‚úì"
          echo "   Stage 4: SonarQube Analysis ‚úì"
          echo "   Stage 5: Build & Tag Docker Image ‚úì"
          echo "   Stage 6: Push to Docker Hub ‚úì"
          echo "   Stage 7: Deploy to Kubernetes ‚úì"
          echo "   Stage 8: K8s Security (DAST with OWASP ZAP) ‚úì"
          echo "   Stage 9: Security Report Consolidation ‚úì"
          echo ""
          echo "‚ö° Parallel execution: SAST, Secrets, Tests, and Policy checks run simultaneously"
          echo "üîí Security scanning integrated at multiple stages"
          echo "üì¶ Application deployed to Kubernetes"
          echo "üåê Access at: http://localhost:30080"
          echo ""
          echo "üìä Consolidated Security Reports Available:"
          echo "   Download the 'consolidated-security-reports' artifact to view:"
          echo "   ‚Ä¢ security-dashboard.html - Interactive HTML dashboard"
          echo "   ‚Ä¢ security-report.md - Markdown summary report"
          echo "   ‚Ä¢ summary.txt - Quick statistics"
